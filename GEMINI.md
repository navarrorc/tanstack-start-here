# TanStack Start Starter Template - Project Context

## Project Overview

This is a production-ready starter template for building full-stack applications using **TanStack Start**. It implements a complete authentication system with Google OAuth and an invite-only user management flow. The architecture leverages modern standards for React full-stack development, utilizing the TanStack ecosystem.

### Key Technologies
*   **Framework:** TanStack Start (React + SSR + Server Functions)
*   **Routing:** TanStack Router (File-based routing)
*   **State Management:** TanStack Query & TanStack Store
*   **Database:** PostgreSQL (via NeonDB serverless)
*   **ORM:** Drizzle ORM
*   **Authentication:** Google OAuth 2.0 (via Arctic) + Custom Session Management
*   **Styling:** Tailwind CSS + Shadcn UI

### Core Architecture
*   **Frontend & Backend Unified:** Uses TanStack Start to blend client-side interactivity with server-side logic (Server Functions).
*   **Invite-Only System:**
    *   First user to sign up becomes the **Admin**.
    *   Subsequent users require an invite code generated by an Admin.
    *   Invite codes are cryptographically secure and tied to specific email addresses.
*   **Database Schema:** Managed via Drizzle, containing `users`, `invite_codes`, and `sessions`.

## Building and Running

### Prerequisites
*   Node.js (v20+ recommended)
*   pnpm
*   PostgreSQL database (NeonDB recommended)
*   Google Cloud OAuth Credentials

### Key Commands

| Command | Description |
| :--- | :--- |
| `pnpm install` | Install dependencies. |
| `pnpm dev` | Start the development server (localhost:3000). |
| `pnpm build` | Build the application for production. |
| `pnpm serve` | Preview the production build locally. |
| `pnpm db:push` | Push schema changes to the database (run after modifying `schema.ts`). |
| `pnpm db:studio` | Open Drizzle Studio to view/edit database content. |
| `pnpm test` | Run tests via Vitest. |

### Environment Setup
Create a `.env.local` file with the following keys (see `.env.example`):
*   `DATABASE_URL`: Connection string for NeonDB (Transaction/Pooled).
*   `GOOGLE_CLIENT_ID`: OAuth Client ID.
*   `GOOGLE_CLIENT_SECRET`: OAuth Client Secret.
*   `GOOGLE_REDIRECT_URI`: `http://localhost:3000/api/auth/callback/google`

## Project Structure & Conventions

### Directory Map
*   **`src/routes/`**: Application routes (TanStack Router).
    *   `__root.tsx`: Global layout (providers, global UI).
    *   `api/`: API endpoints (mostly for Auth callbacks).
    *   `dashboard.tsx`: Main authenticated view.
*   **`src/db/`**: Database configuration.
    *   `schema.ts`: Drizzle schema definitions.
    *   `index.ts`: Database connection initialization.
*   **`src/lib/`**:
    *   `server-functions.ts`: RPC-style server functions callable from the client.
    *   `auth.ts`: Authentication utilities (session validation, hashing).
*   **`drizzle/`**: Database migrations and snapshots.

### Development Guidelines

1.  **Routing:** Add new files to `src/routes/` to create routes. Use `createFileRoute` for type-safe routing.
2.  **Server State:** Use **TanStack Query** (`useQuery`, `useMutation`) for fetching/mutating data.
3.  **Server Logic:** Place backend logic in `src/lib/server-functions.ts` using `createServerFn`. This ensures type safety across the network boundary.
4.  **Database:** Modify `src/db/schema.ts` for schema changes, then run `pnpm db:push`. Avoid manual SQL migrations unless necessary.
5.  **Styling:** Use Tailwind utility classes. Reusable components should be placed in `src/components/`.
6.  **Type Safety:** The project is strict TypeScript. Ensure all server functions and database interactions are fully typed (Drizzle and Zod help here).

## Database Schema Highlights

*   **Users:** Stores `googleId`, `email`, and `isAdmin` flag.
*   **Sessions:** HttpOnly session management with SHA-256 hashed tokens.
*   **InviteCodes:** Tracks codes, usage status, creator, and target email.

## Common Issues
*   **"Either connection url..."**: Missing `DATABASE_URL` in `.env.local`.
*   **"Redirect URI mismatch"**: Google Cloud Console URI doesn't match local config.
*   **"Invite code required"**: Trying to sign up a non-admin user without a generated link.
